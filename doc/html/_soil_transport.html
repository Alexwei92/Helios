<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Soil Transport Model Plugin Documentation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="Helios_logo_small.png"/></td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Soil Transport Model Plugin Documentation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#Description">Model Description</a><ul><li class="level2"><a href="#Intro">Introduction</a></li>
<li class="level2"><a href="#SoilProps">Soil Property Model</a><ul><li class="level3"><a href="#DeterminingProps">Determining Soil Coefficients from Data</a></li>
</ul>
</li>
<li class="level2"><a href="#Solution">Discrete Solution</a></li>
<li class="level2"><a href="#InputVariables">Input Variables</a></li>
<li class="level2"><a href="#InputProperties">Input Properties</a></li>
<li class="level2"><a href="#OutputVariables">Output Variables</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="Description"></a>
Model Description</h1>
<h2><a class="anchor" id="Intro"></a>
Introduction</h2>
<p>This model simulates the transport of water and other constituents in the soil. Water transport is based on a numerical solution of the Richards equation (<a href="http://dx.doi.org/10.1063/1.1745010">Richards; 1931</a>), which yeilds the pressure head at various soil depths for each soil primitive.</p>
<p>The Richards equation is given by</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \frac{\partial \theta}{\partial h}\frac{\partial h}{\partial t} = \frac{\partial}{\partial z}\left[ K\left(\frac{\partial h}{\partial z}+1\right)\right] + S, \]" src="form_119.png"/>
</p>
<p>where <img class="formulaInl" alt="$\theta$" src="form_3.png"/> is the soil volumetric water content (m<sup>3</sup> water per m<sup>3</sup> soil), <img class="formulaInl" alt="$h$" src="form_13.png"/> is the water pressure head (m of water), <img class="formulaInl" alt="$K$" src="form_120.png"/> is the hydraulic conductivity ( m<sup>3</sup> water per m<sup>2</sup> soil surface per second), <img class="formulaInl" alt="$S$" src="form_121.png"/> is a generic source/sink (+/-) term (m<sup>3</sup> water per m<sup>3</sup> soil per second), <img class="formulaInl" alt="$t$" src="form_122.png"/> is time, and <img class="formulaInl" alt="$z$" src="form_123.png"/> is the vertical coordinate.</p>
<p>The flux of water at any height [m<sup>3</sup> water per m<sup>2</sup> ground per second] is given by Darcy's law</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ q = -K\frac{dh}{dz}, \]" src="form_124.png"/>
</p>
<p>where we have taken the convention that a positive flux corresponds to upward movement of water.</p>
<h2><a class="anchor" id="SoilProps"></a>
Soil Property Model</h2>
<p>The soil moisture characteristic <img class="formulaInl" alt="$\partial \theta/\partial h$" src="form_125.png"/> and the hydraulic conductivity are specific for the type of soil. In this model implementation, the empirical relations of <a href="https://dx.doi.org/doi:10.2136/sssaj1980.03615995004400050002x">van Genuchten (1980)</a> are used. van Genuchten related the soil volumetric water content ( <img class="formulaInl" alt="$\theta$" src="form_3.png"/>) to the hydraulic head ( <img class="formulaInl" alt="$h$" src="form_13.png"/>) as</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \theta = \theta_r + \frac{\theta_s-\theta_r}{\left[1+\left(\alpha\big| h\big|\right)^n\right]^m} \]" src="form_126.png"/>
</p>
<p><img class="formulaInl" alt="$\theta_r$" src="form_127.png"/> and <img class="formulaInl" alt="$\theta_s$" src="form_128.png"/> are the residual and saturated soil volumetric water content, respectively. These values are typically known directly from the <img class="formulaInl" alt="$\theta-h$" src="form_129.png"/> curve: <img class="formulaInl" alt="$\theta_r$" src="form_127.png"/> is the asymptotic value of <img class="formulaInl" alt="$\theta$" src="form_3.png"/> as <img class="formulaInl" alt="$h \rightarrow -\infty$" src="form_130.png"/>, and <img class="formulaInl" alt="$\theta_s$" src="form_128.png"/> is the asymptotic value of <img class="formulaInl" alt="$\theta$" src="form_3.png"/> as <img class="formulaInl" alt="$h \rightarrow 0$" src="form_131.png"/>. The coefficients <img class="formulaInl" alt="$n$" src="form_132.png"/>, <img class="formulaInl" alt="$m$" src="form_133.png"/>, and <img class="formulaInl" alt="$\alpha$" src="form_134.png"/> are empirical parameters, which can be found by fitting the above equation for <img class="formulaInl" alt="$\theta$" src="form_3.png"/> to data describing <img class="formulaInl" alt="$\theta$" src="form_3.png"/> vs. <img class="formulaInl" alt="$h$" src="form_13.png"/>. This equation can be differentiated with respect to <img class="formulaInl" alt="$h$" src="form_13.png"/> to give</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \frac{\partial \theta}{\partial h} = \frac{\alpha\,m\,n \left(\theta_s-\theta_r\right)\left(\alpha\big| h \big|\right)^{n-1}}{\left[1+\left(\alpha\big| h \big| \right)^n\right]^{m+1}} \]" src="form_135.png"/>
</p>
<p>van Genuchten used this expression to derive an equation describing the variation of hydraulic conductivity with water content</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ K = K_s\left\{ \frac{ \left[ 1-(\alpha \big| h\big|)^{n-1}\left[1+(\alpha \big| h\big|)^{n}\right]^{-m}\right]^2 }{\left[1+(\alpha \big| h\big|)^{n}\right]^{m/2}}\right\} \]" src="form_136.png"/>
</p>
<p>subject to the constraint <img class="formulaInl" alt="$m=1-1/n$" src="form_137.png"/>, where <img class="formulaInl" alt="$K_s$" src="form_138.png"/> is the soil hydraulic conductivity at saturation (m<sup>3</sup> water per m<sup>2</sup> soil surface per second).</p>
<h3><a class="anchor" id="DeterminingProps"></a>
Determining Soil Coefficients from Data</h3>
<p>The measured <img class="formulaInl" alt="$\theta$" src="form_3.png"/> vs. <img class="formulaInl" alt="$h$" src="form_13.png"/> curve can be used to determine the empirical soil parameters (see figure below). <img class="formulaInl" alt="$\theta_r$" src="form_127.png"/> and <img class="formulaInl" alt="$\theta_s$" src="form_128.png"/> can be read directly from the figure, since they are the bounds of the <img class="formulaInl" alt="$\theta$" src="form_3.png"/> vs. <img class="formulaInl" alt="$h$" src="form_13.png"/> curve. A best-fit can determine the coefficients <img class="formulaInl" alt="$n$" src="form_132.png"/>, <img class="formulaInl" alt="$m$" src="form_133.png"/>, and <img class="formulaInl" alt="$\alpha$" src="form_134.png"/>.</p>
<div class="image">
<img src="SoilMoistureCurve.png" alt="SoilMoistureCurve.png"/>
<div class="caption">
Typical soil moisture characteristic curve (figure from van Genuchten (1980)).</div></div>
<table class="doxtable">
<tr>
<th>Parameter </th><th>Units </th><th>Description  </th></tr>
<tr>
<td><img class="formulaInl" alt="$\theta_r$" src="form_127.png"/> </td><td>m<sup>3</sup> water per m<sup>3</sup> soil </td><td>Residual volumetric water content (i.e., <img class="formulaInl" alt="$\theta$" src="form_3.png"/> when <img class="formulaInl" alt="$h \rightarrow -\infty$" src="form_130.png"/>)   </td></tr>
<tr>
<td><img class="formulaInl" alt="$\theta_s$" src="form_128.png"/> </td><td>m<sup>3</sup> water per m<sup>3</sup> soil </td><td>Volumetric water content at saturation (i.e., <img class="formulaInl" alt="$\theta$" src="form_3.png"/> when <img class="formulaInl" alt="$h \rightarrow 0$" src="form_131.png"/>)   </td></tr>
<tr>
<td><img class="formulaInl" alt="$K_s$" src="form_138.png"/> </td><td>m<sup>3</sup> water per m<sup>3</sup> soil </td><td>Hydraulic conductivity at saturation (i.e., <img class="formulaInl" alt="$K$" src="form_120.png"/> when <img class="formulaInl" alt="$h \rightarrow 0$" src="form_131.png"/>)   </td></tr>
<tr>
<td><img class="formulaInl" alt="$\alpha,\,n,\,m$" src="form_139.png"/> </td><td>unitless </td><td>van Genuchten empirical parameters  </td></tr>
</table>
<h2><a class="anchor" id="Solution"></a>
Discrete Solution</h2>
<p>The Crank-Nicolson scheme is used to discretize the Richards equation in time, which is unconditionally stable. Spatial derivatives are discretized using a second-order accurate centered scheme. Applying this scheme to the Richards equation gives</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ -\left[\frac{K_k^n}{2(\Delta z)^2}+\frac{(dK/dz)^n_k}{4\Delta z}\right]h_{k+1}^{n+1}+\left[ \frac{C_r}{\Delta t}+\frac{K_k^n}{(\Delta z)^2}\right]h_k^{n+1}-\left[\frac{K_k^n}{2(\Delta z)^2}-\frac{(dK/dz)^n_k}{4\Delta z}\right]h_{k-1}^{n+1}=\frac{C_r}{\Delta t}h_k^n+\frac{K_k^n}{2(\Delta z)^2}\left(h_{k+1}^n-2h_k^n+h_{k-1}^n\right)+\left[\left(\frac{h^n_{k+1}-h^n_{k-1}}{4\Delta z}\right)+1\right]\left(\frac{dK}{dz}\right)^n_k+S_k^n, \]" src="form_140.png"/>
</p>
<p>where</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \frac{dK}{dz}=\frac{K_{k+1}-K_{k-1}}{2\Delta z}, \]" src="form_141.png"/>
</p>
<p><img class="formulaInl" alt="$C_r=\partial \theta/\partial h$" src="form_142.png"/> is the soil moisture characteristic, superscript <img class="formulaInl" alt="$n$" src="form_132.png"/> is an evaluation at time <img class="formulaInl" alt="$t$" src="form_122.png"/> and <img class="formulaInl" alt="$n+1$" src="form_143.png"/> is an evaluation at time <img class="formulaInl" alt="$t+\Delta t$" src="form_144.png"/>. The the above equation corresponst to a tridiagonal linear system of equations of the form <img class="formulaInl" alt="$Ah=b$" src="form_145.png"/>, which can be inverted to solve for <img class="formulaInl" alt="$h$" src="form_13.png"/> at every <img class="formulaInl" alt="$z$" src="form_123.png"/> level. To see a derivation of the discrete equations <a href="../../plugins/soiltransport/doc/images/Richards_CN_discretization_deriv.pdf">click here</a>.</p>
<p>The upper boundary is specified by a constant moisture flux <img class="formulaInl" alt="$q_s$" src="form_150.png"/> (m<sup>3</sup> water per m<sup>2</sup> soil surface per second), which is specified by a second-order upwind discretization of Darcy's law</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ h_1 = -\frac{1}{3}h_3+\frac{4}{3}h_2+\frac{2\Delta z}{3K_1}q_s. \]" src="form_146.png"/>
</p>
<p>The lower boundary is typically specified as saturated (i.e., <img class="formulaInl" alt="$h_N=0$" src="form_147.png"/>), but it could also be specified as constant flux /f$q_b$/f similar to above</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ h_N = \frac{4}{3}h_{N-1}-\frac{1}{3}h_{N-2}-\frac{2\Delta z}{3K_N}q_b. \]" src="form_148.png"/>
</p>
<p>To see a derivation of the discrete boundary conditions <a href="images/Richards_CN_discretization_deriv.pdf">click here</a>.</p>
<h1><a class="anchor" id="Dependencies"></a>
Dependencies</h1>
<table class="doxtable">
<tr>
<th>Package </th><th>Version </th><th>Link </th><th>apt-get command </th><th>homebrew command  </th></tr>
<tr>
<td>NVIDIA CUDA </td><td>5.0+ </td><td><a href="https://developer.nvidia.com/cuda-zone">developer.nvidia.com/cuda-zone</a> </td><td><code>$ sudo apt-get install cuda</code> </td><td><code>$ brew install Caskroom/cask/cuda</code>  </td></tr>
</table>
<h1><a class="anchor" id="VarsAndProps"></a>
Primitive Data</h1>
<h2><a class="anchor" id="InputVariables"></a>
Input Variables</h2>
<table class="doxtable">
<tr>
<th>Variable </th><th>Description </th><th>Default behavior  </th></tr>
<tr>
<td>moisture_flux </td><td>Volumetric flux of moisture (water) at the primitive surface [m<sup>3</sup> water / m<sup>2</sup> surface - sec] </td><td>Initialized to default of 0  </td></tr>
</table>
<h2><a class="anchor" id="InputProperties"></a>
Input Properties</h2>
<table class="doxtable">
<tr>
<th>Property </th><th>Description </th><th><p class="starttd">Default behavior </p>
<p class="endtd"></p>
</th></tr>
</table>
<h2><a class="anchor" id="OutputVariables"></a>
Output Variables</h2>
<table class="doxtable">
<tr>
<th>Variable </th><th>Description  </th></tr>
<tr>
<td>volumetric_water_content </td><td>Surface volumetric water content [m<sup>3</sup> water / m<sup>3</sup> soil]  </td></tr>
<tr>
<td>pressure_head </td><td>Surface water pressure head [m water]  </td></tr>
</table>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
